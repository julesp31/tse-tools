from flask import Flask, request, render_template, jsonify
from free_busy_times import get_busy_list  # Import the function for extracting free/busy data
from oit_slots import get_oit_list  # Import the function for extracting OIT slots

app = Flask(__name__)

@app.route("/", methods=["GET", "POST"])
def index():
    return render_template("index.html")

@app.route("/process", methods=["POST"])
def process():
    data = request.get_json()
    input_text = data.get("text", "")
    
    athena_query = str(input_text)
    
    free_busy_data = get_busy_list(athena_query)
    oit_slots = get_oit_list(athena_query)
    
    output = {
        "free_busy_data": free_busy_data,
        "oit_slots": oit_slots
    }
    
    return jsonify(output)

if __name__ == "__main__":
    app.run(debug=True)


# def main():

#     # Getting Busy and OIT Times from Athena Query
#     print()
    # athena_query = str("{'u_2170506': {2170506: {'free_busy_data': [{'End': {'DateTime': '2024-11-20T15:00:00.0000000', 'TimeZone': 'UTC'}, 'IsAllDay': False, 'ShowAs': 'busy', 'Start': {'DateTime': '2024-11-20T14:00:00.0000000', 'TimeZone': 'UTC'}}, {'End': {'DateTime': '2024-11-20T17:00:00.0000000', 'TimeZone': 'UTC'}, 'IsAllDay': False, 'ShowAs': 'busy', 'Start': {'DateTime': '2024-11-20T15:30:00.0000000', 'TimeZone': 'UTC'}}, {'End': {'DateTime': '2024-11-20T21:15:00.0000000', 'TimeZone': 'UTC'}, 'IsAllDay': False, 'ShowAs': 'busy', 'Start': {'DateTime': '2024-11-20T20:30:00.0000000', 'TimeZone': 'UTC'}}, {'End': {'DateTime': '2024-11-22T15:30:00.0000000', 'TimeZone': 'UTC'}, 'IsAllDay': False, 'ShowAs': 'busy', 'Start': {'DateTime': '2024-11-22T15:00:00.0000000', 'TimeZone': 'UTC'}}, {'End': {'DateTime': '2024-11-22T19:00:00.0000000', 'TimeZone': 'UTC'}, 'IsAllDay': False, 'ShowAs': 'busy', 'Start': {'DateTime': '2024-11-22T17:00:00.0000000', 'TimeZone': 'UTC'}}, {'End': {'DateTime': '2024-11-22T20:00:00.0000000', 'TimeZone': 'UTC'}, 'IsAllDay': False, 'ShowAs': 'busy', 'Start': {'DateTime': '2024-11-22T19:30:00.0000000', 'TimeZone': 'UTC'}}, {'End': {'DateTime': '2024-11-22T19:45:00.0000000', 'TimeZone': 'UTC'}, 'IsAllDay': False, 'ShowAs': 'free', 'Start': {'DateTime': '2024-11-22T19:30:00.0000000', 'TimeZone': 'UTC'}}, {'End': {'DateTime': '2024-11-22T20:30:00.0000000', 'TimeZone': 'UTC'}, 'IsAllDay': False, 'ShowAs': 'busy', 'Start': {'DateTime': '2024-11-22T20:00:00.0000000', 'TimeZone': 'UTC'}}, {'End': {'DateTime': '2024-11-22T21:15:00.0000000', 'TimeZone': 'UTC'}, 'IsAllDay': False, 'ShowAs': 'busy', 'Start': {'DateTime': '2024-11-22T20:30:00.0000000', 'TimeZone': 'UTC'}}, {'End': {'DateTime': '2024-11-22T23:00:00.0000000', 'TimeZone': 'UTC'}, 'IsAllDay': False, 'ShowAs': 'busy', 'Start': {'DateTime': '2024-11-22T21:00:00.0000000', 'TimeZone': 'UTC'}}, {'End': {'DateTime': '2024-11-25T15:30:00.0000000', 'TimeZone': 'UTC'}, 'IsAllDay': False, 'ShowAs': 'busy', 'Start': {'DateTime': '2024-11-25T15:00:00.0000000', 'TimeZone': 'UTC'}}, {'End': {'DateTime': '2024-11-25T17:30:00.0000000', 'TimeZone': 'UTC'}, 'IsAllDay': False, 'ShowAs': 'busy', 'Start': {'DateTime': '2024-11-25T16:00:00.0000000', 'TimeZone': 'UTC'}}, {'End': {'DateTime': '2024-11-25T19:00:00.0000000', 'TimeZone': 'UTC'}, 'IsAllDay': False, 'ShowAs': 'busy', 'Start': {'DateTime': '2024-11-25T17:30:00.0000000', 'TimeZone': 'UTC'}}, {'End': {'DateTime': '2024-11-25T19:30:00.0000000', 'TimeZone': 'UTC'}, 'IsAllDay': False, 'ShowAs': 'busy', 'Start': {'DateTime': '2024-11-25T19:00:00.0000000', 'TimeZone': 'UTC'}}, {'End': {'DateTime': '2024-11-25T20:00:00.0000000', 'TimeZone': 'UTC'}, 'IsAllDay': False, 'ShowAs': 'busy', 'Start': {'DateTime': '2024-11-25T19:30:00.0000000', 'TimeZone': 'UTC'}}, {'End': {'DateTime': '2024-11-25T20:30:00.0000000', 'TimeZone': 'UTC'}, 'IsAllDay': False, 'ShowAs': 'busy', 'Start': {'DateTime': '2024-11-25T20:00:00.0000000', 'TimeZone': 'UTC'}}, {'End': {'DateTime': '2024-11-25T21:15:00.0000000', 'TimeZone': 'UTC'}, 'IsAllDay': False, 'ShowAs': 'busy', 'Start': {'DateTime': '2024-11-25T20:30:00.0000000', 'TimeZone': 'UTC'}}, {'End': {'DateTime': '2024-11-27T21:15:00.0000000', 'TimeZone': 'UTC'}, 'IsAllDay': False, 'ShowAs': 'busy', 'Start': {'DateTime': '2024-11-27T20:30:00.0000000', 'TimeZone': 'UTC'}}, {'End': {'DateTime': '2024-11-29T05:15:00.0000000', 'TimeZone': 'UTC'}, 'IsAllDay': False, 'ShowAs': 'busy', 'Start': {'DateTime': '2024-11-28T10:45:00.0000000', 'TimeZone': 'UTC'}}, {'End': {'DateTime': '2024-11-30T05:15:00.0000000', 'TimeZone': 'UTC'}, 'IsAllDay': False, 'ShowAs': 'busy', 'Start': {'DateTime': '2024-11-29T09:15:00.0000000', 'TimeZone': 'UTC'}}, {'End': {'DateTime': '2024-11-29T15:30:00.0000000', 'TimeZone': 'UTC'}, 'IsAllDay': False, 'ShowAs': 'free', 'Start': {'DateTime': '2024-11-29T15:00:00.0000000', 'TimeZone': 'UTC'}}, {'End': {'DateTime': '2024-11-29T21:15:00.0000000', 'TimeZone': 'UTC'}, 'IsAllDay': False, 'ShowAs': 'busy', 'Start': {'DateTime': '2024-11-29T20:30:00.0000000', 'TimeZone': 'UTC'}}, {'End': {'DateTime': '2024-11-29T23:00:00.0000000', 'TimeZone': 'UTC'}, 'IsAllDay': False, 'ShowAs': 'busy', 'Start': {'DateTime': '2024-11-29T21:00:00.0000000', 'TimeZone': 'UTC'}}, {'End': {'DateTime': '2024-12-02T14:30:00.0000000', 'TimeZone': 'UTC'}, 'IsAllDay': False, 'ShowAs': 'busy', 'Start': {'DateTime': '2024-12-02T14:00:00.0000000', 'TimeZone': 'UTC'}}, {'End': {'DateTime': '2024-12-02T15:30:00.0000000', 'TimeZone': 'UTC'}, 'IsAllDay': False, 'ShowAs': 'busy', 'Start': {'DateTime': '2024-12-02T15:00:00.0000000', 'TimeZone': 'UTC'}}, {'End': {'DateTime': '2024-12-02T17:30:00.0000000', 'TimeZone': 'UTC'}, 'IsAllDay': False, 'ShowAs': 'busy', 'Start': {'DateTime': '2024-12-02T17:00:00.0000000', 'TimeZone': 'UTC'}}, {'End': {'DateTime': '2024-12-02T23:00:00.0000000', 'TimeZone': 'UTC'}, 'IsAllDay': False, 'ShowAs': 'busy', 'Start': {'DateTime': '2024-12-02T20:00:00.0000000', 'TimeZone': 'UTC'}}, {'End': {'DateTime': '2024-12-02T21:15:00.0000000', 'TimeZone': 'UTC'}, 'IsAllDay': False, 'ShowAs': 'busy', 'Start': {'DateTime': '2024-12-02T20:30:00.0000000', 'TimeZone': 'UTC'}}, {'End': {'DateTime': '2024-12-03T01:40:00.0000000', 'TimeZone': 'UTC'}, 'IsAllDay': False, 'ShowAs': 'busy', 'Start': {'DateTime': '2024-12-02T23:05:00.0000000', 'TimeZone': 'UTC'}}, {'End': {'DateTime': '2024-12-03T18:30:00.0000000', 'TimeZone': 'UTC'}, 'IsAllDay': False, 'ShowAs': 'busy', 'Start': {'DateTime': '2024-12-03T13:30:00.0000000', 'TimeZone': 'UTC'}}], 'internal_busy_times': [], 'native_cal_data': {'busy_times': [], 'oits': [{'end': '2024-11-20T18:00:00Z', 'group_ids': '', 'group_ids_list': [], 'job_requisition_ids': {'ats_job_ids': [], 'client_job_ids': []}, 'jobloc_ids': '', 'jobloc_ids_list': [], 'oit_number': 1, 'oit_types': '8,1,2,5', 'oit_types_list': [1, 2, 5, 8], 'priority': False, 'start': '2024-11-20T15:00:00Z', 'user_id': 2170506}, {'end': '2024-11-20T23:00:00Z', 'group_ids': '', 'group_ids_list': [], 'job_requisition_ids': {'ats_job_ids': [], 'client_job_ids': []}, 'jobloc_ids': '', 'jobloc_ids_list': [], 'oit_number': 1, 'oit_types': '8,1,2,5', 'oit_types_list': [1, 2, 5, 8], 'priority': False, 'start': '2024-11-20T19:00:00Z', 'user_id': 2170506}, {'end': '2024-11-21T18:00:00Z', 'group_ids': '', 'group_ids_list': [], 'job_requisition_ids': {'ats_job_ids': [], 'client_job_ids': []}, 'jobloc_ids': '', 'jobloc_ids_list': [], 'oit_number': 1, 'oit_types': '8,1,2,5', 'oit_types_list': [1, 2, 5, 8], 'priority': False, 'start': '2024-11-21T15:00:00Z', 'user_id': 2170506}, {'end': '2024-11-21T23:00:00Z', 'group_ids': '', 'group_ids_list': [], 'job_requisition_ids': {'ats_job_ids': [], 'client_job_ids': []}, 'jobloc_ids': '', 'jobloc_ids_list': [], 'oit_number': 1, 'oit_types': '8,1,2,5', 'oit_types_list': [1, 2, 5, 8], 'priority': False, 'start': '2024-11-21T19:00:00Z', 'user_id': 2170506}, {'end': '2024-11-22T18:00:00Z', 'group_ids': '', 'group_ids_list': [], 'job_requisition_ids': {'ats_job_ids': [], 'client_job_ids': []}, 'jobloc_ids': '', 'jobloc_ids_list': [], 'oit_number': 1, 'oit_types': '8,1,2,5', 'oit_types_list': [1, 2, 5, 8], 'priority': False, 'start': '2024-11-22T15:00:00Z', 'user_id': 2170506}, {'end': '2024-11-22T23:00:00Z', 'group_ids': '', 'group_ids_list': [], 'job_requisition_ids': {'ats_job_ids': [], 'client_job_ids': []}, 'jobloc_ids': '', 'jobloc_ids_list': [], 'oit_number': 1, 'oit_types': '8,1,2,5', 'oit_types_list': [1, 2, 5, 8], 'priority': False, 'start': '2024-11-22T19:00:00Z', 'user_id': 2170506}, {'end': '2024-11-25T18:00:00Z', 'group_ids': '', 'group_ids_list': [], 'job_requisition_ids': {'ats_job_ids': [], 'client_job_ids': []}, 'jobloc_ids': '', 'jobloc_ids_list': [], 'oit_number': 1, 'oit_types': '8,1,2,5', 'oit_types_list': [1, 2, 5, 8], 'priority': False, 'start': '2024-11-25T15:00:00Z', 'user_id': 2170506}, {'end': '2024-11-25T23:00:00Z', 'group_ids': '', 'group_ids_list': [], 'job_requisition_ids': {'ats_job_ids': [], 'client_job_ids': []}, 'jobloc_ids': '', 'jobloc_ids_list': [], 'oit_number': 1, 'oit_types': '8,1,2,5', 'oit_types_list': [1, 2, 5, 8], 'priority': False, 'start': '2024-11-25T19:00:00Z', 'user_id': 2170506}, {'end': '2024-11-26T18:00:00Z', 'group_ids': '', 'group_ids_list': [], 'job_requisition_ids': {'ats_job_ids': [], 'client_job_ids': []}, 'jobloc_ids': '', 'jobloc_ids_list': [], 'oit_number': 1, 'oit_types': '8,1,2,5', 'oit_types_list': [1, 2, 5, 8], 'priority': False, 'start': '2024-11-26T15:00:00Z', 'user_id': 2170506}, {'end': '2024-11-26T23:00:00Z', 'group_ids': '', 'group_ids_list': [], 'job_requisition_ids': {'ats_job_ids': [], 'client_job_ids': []}, 'jobloc_ids': '', 'jobloc_ids_list': [], 'oit_number': 1, 'oit_types': '8,1,2,5', 'oit_types_list': [1, 2, 5, 8], 'priority': False, 'start': '2024-11-26T19:00:00Z', 'user_id': 2170506}, {'end': '2024-11-27T18:00:00Z', 'group_ids': '', 'group_ids_list': [], 'job_requisition_ids': {'ats_job_ids': [], 'client_job_ids': []}, 'jobloc_ids': '', 'jobloc_ids_list': [], 'oit_number': 1, 'oit_types': '8,1,2,5', 'oit_types_list': [1, 2, 5, 8], 'priority': False, 'start': '2024-11-27T15:00:00Z', 'user_id': 2170506}, {'end': '2024-11-27T23:00:00Z', 'group_ids': '', 'group_ids_list': [], 'job_requisition_ids': {'ats_job_ids': [], 'client_job_ids': []}, 'jobloc_ids': '', 'jobloc_ids_list': [], 'oit_number': 1, 'oit_types': '8,1,2,5', 'oit_types_list': [1, 2, 5, 8], 'priority': False, 'start': '2024-11-27T19:00:00Z', 'user_id': 2170506}, {'end': '2024-11-28T18:00:00Z', 'group_ids': '', 'group_ids_list': [], 'job_requisition_ids': {'ats_job_ids': [], 'client_job_ids': []}, 'jobloc_ids': '', 'jobloc_ids_list': [], 'oit_number': 1, 'oit_types': '8,1,2,5', 'oit_types_list': [1, 2, 5, 8], 'priority': False, 'start': '2024-11-28T15:00:00Z', 'user_id': 2170506}, {'end': '2024-11-28T23:00:00Z', 'group_ids': '', 'group_ids_list': [], 'job_requisition_ids': {'ats_job_ids': [], 'client_job_ids': []}, 'jobloc_ids': '', 'jobloc_ids_list': [], 'oit_number': 1, 'oit_types': '8,1,2,5', 'oit_types_list': [1, 2, 5, 8], 'priority': False, 'start': '2024-11-28T19:00:00Z', 'user_id': 2170506}, {'end': '2024-11-29T18:00:00Z', 'group_ids': '', 'group_ids_list': [], 'job_requisition_ids': {'ats_job_ids': [], 'client_job_ids': []}, 'jobloc_ids': '', 'jobloc_ids_list': [], 'oit_number': 1, 'oit_types': '8,1,2,5', 'oit_types_list': [1, 2, 5, 8], 'priority': False, 'start': '2024-11-29T15:00:00Z', 'user_id': 2170506}, {'end': '2024-11-29T23:00:00Z', 'group_ids': '', 'group_ids_list': [], 'job_requisition_ids': {'ats_job_ids': [], 'client_job_ids': []}, 'jobloc_ids': '', 'jobloc_ids_list': [], 'oit_number': 1, 'oit_types': '8,1,2,5', 'oit_types_list': [1, 2, 5, 8], 'priority': False, 'start': '2024-11-29T19:00:00Z', 'user_id': 2170506}, {'end': '2024-12-02T18:00:00Z', 'group_ids': '', 'group_ids_list': [], 'job_requisition_ids': {'ats_job_ids': [], 'client_job_ids': []}, 'jobloc_ids': '', 'jobloc_ids_list': [], 'oit_number': 1, 'oit_types': '8,1,2,5', 'oit_types_list': [1, 2, 5, 8], 'priority': False, 'start': '2024-12-02T15:00:00Z', 'user_id': 2170506}, {'end': '2024-12-02T23:00:00Z', 'group_ids': '', 'group_ids_list': [], 'job_requisition_ids': {'ats_job_ids': [], 'client_job_ids': []}, 'jobloc_ids': '', 'jobloc_ids_list': [], 'oit_number': 1, 'oit_types': '8,1,2,5', 'oit_types_list': [1, 2, 5, 8], 'priority': False, 'start': '2024-12-02T19:00:00Z', 'user_id': 2170506}, {'end': '2024-12-03T18:00:00Z', 'group_ids': '', 'group_ids_list': [], 'job_requisition_ids': {'ats_job_ids': [], 'client_job_ids': []}, 'jobloc_ids': '', 'jobloc_ids_list': [], 'oit_number': 1, 'oit_types': '8,1,2,5', 'oit_types_list': [1, 2, 5, 8], 'priority': False, 'start': '2024-12-03T15:00:00Z', 'user_id': 2170506}]}, 'scheduled_times': [{'end': '2024-11-19T20:15:00Z', 'itv_start_time_control_type': 1, 'lead_ids': [182924285], 'start': '2024-11-19T19:45:00Z', 'user_id': 2170506}, {'end': '2024-11-19T21:30:00Z', 'itv_start_time_control_type': 1, 'lead_ids': [183924055], 'start': '2024-11-19T21:00:00Z', 'user_id': 2170506}, {'end': '2024-11-19T23:00:00Z', 'itv_start_time_control_type': 1, 'lead_ids': [184386976], 'start': '2024-11-19T22:30:00Z', 'user_id': 2170506}, {'end': '2024-11-22T20:00:00Z', 'itv_start_time_control_type': 1, 'lead_ids': [182586181], 'start': '2024-11-22T19:30:00Z', 'user_id': 2170506}, {'end': '2024-11-22T20:30:00Z', 'itv_start_time_control_type': 1, 'lead_ids': [182029782], 'start': '2024-11-22T20:00:00Z', 'user_id': 2170506}, {'end': '2024-11-25T19:30:00Z', 'itv_start_time_control_type': 1, 'lead_ids': [183857545], 'start': '2024-11-25T19:00:00Z', 'user_id': 2170506}, {'end': '2024-11-25T20:00:00Z', 'itv_start_time_control_type': 1, 'lead_ids': [184272983], 'start': '2024-11-25T19:30:00Z', 'user_id': 2170506}]}}}")



    # busy_slots = get_busy_list(athena_query)
    # # print()
    # oit_slots = get_oit_list(athena_query)
    # # print()
    # scheduled_slots = get_scheduled_list(athena_query)
    # print()

    # split_days(oit_slots, busy_slots, scheduled_slots)

